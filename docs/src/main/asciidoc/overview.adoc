[partintro]
--
This guide describes the NATS implementation of the Spring Cloud Stream Binder.
It contains information about its design, usage and configuration options, as well as information on how the Stream Cloud Stream concepts map into NATS specific constructs.
--

== Usage

To use the NATS binder, you can add it to your Spring Cloud Stream application, by using the following Maven coordinates:

[source,xml]
----
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-stream-binder-nats</artifactId>
</dependency>
----

Alternatively, you can use the Spring Cloud Stream NATS Starter, as follows:

[source,xml]
----
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-starter-stream-nats</artifactId>
</dependency>
----

== NATS Binder Overview

The following simplified diagram shows how the NATS binder operates:

.NATS Binder
image::{github-raw}/docs/src/main/asciidoc/images/nats-binder.png[width=300,scaledwidth="50%"]

By default, the NATS Binder implementation maps each destination to a `TopicExchange`.
For each consumer group, a `Queue` is bound to that `TopicExchange`.
Each consumer instance has a corresponding NATS `Consumer` instance for its group's `Queue`.
For partitioned producers and consumers, the queues are suffixed with the partition index and use the partition index as the routing key.
For anonymous consumers (those with no `group` property), an auto-delete queue (with a randomized unique name) is used.

See <<nats-binder-properties>> for more information about these properties.

NOTE: When multiple NATS binders are used in a Spring Cloud Stream application, it is important to disable 'natsAutoConfiguration' to avoid the same configuration from `natsAutoConfiguration` being applied to the two binders.
You can exclude the class by using the `@SpringBootApplication` annotation.

== Configuration Options

This section contains settings specific to the NATS Binder and bound channels.

For general binding configuration options and properties, see the https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream-core-docs/src/main/asciidoc/spring-cloud-stream-overview.adoc#configuration-options[Spring Cloud Stream core documentation].

[[nats-binder-properties]]
=== NATS Binder Properties

By default, the NATS binder uses Spring Boot's `ConnectionFactory`.
Conseuqently, it supports all Spring Boot configuration options for NATS.
(For reference, see the https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties[Spring Boot documentation]).
NATS configuration options use the `spring.nats` prefix.

In addition to Spring Boot options, the NATS binder supports the following properties:

TODO:  Document properties...

=== NATS Consumer Properties

NOTE: To avoid repetition, Spring Cloud Stream supports setting values for all channels, in the format of `spring.cloud.stream.default.<property>=<value>`.

The following properties are available for nats consumers only and must be prefixed with `spring.cloud.stream.nats.bindings.<channelName>.consumer.`.

TodoOption::
The desription
+
Default: `default`.
AnotherOption::
blah bla blah
+
Default: `default.`.

